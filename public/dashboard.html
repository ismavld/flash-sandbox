<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Tableau de bord ¬∑ Flash Sandbox</title>
  <link rel="stylesheet" href="/style.css">
  <style>/* Container d'autocompl√©tion */
.autocomplete-container {
  position: relative;
  width: 100%;
}

/* Liste d√©roulante */
.autocomplete-list {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: var(--bg);
  border: 2px solid var(--border);
  border-top: none;
  border-radius: 0 0 8px 8px;
  max-height: 200px;
  overflow-y: auto;
  z-index: 1000;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  display: none;
  margin-top: -2px;  /* ‚Üê Colle au input */
}

.autocomplete-list.show {
  display: block;
}

/* Items de suggestion */
.autocomplete-item {
  padding: 12px 16px;
  cursor: pointer;
  border-bottom: 1px solid var(--bg);
  transition: background-color 0.2s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.autocomplete-item:last-child {
  border-bottom: none;
  border-radius: 0 0 6px 6px;
}

.autocomplete-item:hover,
.autocomplete-item.selected {
  background-color: var(--bg);  /* ‚Üê Hover clair */
}

/* Style du username */
.autocomplete-item .username {
  font-weight: 600;
  color: var(--primary);  /* ‚Üê Couleur primaire */
}

/* Style de l'email */
.autocomplete-item .email {
  font-size: 0.875rem;
  color: var(--text-light);  /* ‚Üê Gris clair */
}

/* √âtats de chargement/vide */
.autocomplete-loading,
.autocomplete-empty {
  padding: 12px 16px;
  text-align: center;
  color: var(--text-light);
  font-size: 0.875rem;
}

  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-content">
        <h1>‚ö° Flash Sandbox</h1>
        <div class="user-menu">
          <button id="darkModeToggle" class="btn-dark-mode" onclick="toggleDarkMode()" title="Basculer en mode sombre">
        üåô
          </button>
          <span id="userUsername" class="user-email">@<span id="usernameText"></span></span>
          <button id="logoutBtn" class="btn-logout">D√©connexion</button>
        </div>
      </div>
    </header>

    <main>
      <section class="hero">
        <h2>Cr√©er une nouvelle sandbox</h2>
        <form id="createForm">
          <input 
            type="text" 
            id="sandboxName" 
            placeholder="nom-de-la-sandbox"
            pattern="[a-zA-Z0-9_-]{3,50}"
            required
            autocomplete="off"
          >
          <button type="submit">Cr√©er ‚Üí</button>
        </form>
        <p class="hint">3-50 caract√®res : lettres, chiffres, tirets ou underscores</p>
      </section>

      <section class="sandboxes">
        <h2>Mes sandboxes</h2>
        <div id="sandboxList">
          <p class="loading">Chargement...</p>
        </div>
      </section>
    </main>

    <footer>
      <p>
        Mode √©ph√©m√®re ¬∑ Purge auto apr√®s <strong>12h</strong> d'inactivit√©<br>
        <a href="/health" target="_blank">√âtat du serveur</a>
      </p>
    </footer>
  </div>

  <!-- Modal de partage -->
  <div id="shareModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Partager la sandbox</h3>
      </div>
      <div class="modal-body">
        <p>Entrez le nom d'utilisateur avec qui partager :</p>
        <form id="shareForm">
          <div class="autocomplete-container">
            <input 
              type="text" 
              id="shareUsername" 
              placeholder="@username"
              required
              autocomplete="off"
            >
            <div id="autocompleteList" class="autocomplete-list"></div>
          </div>
          <button type="submit" class="btn-primary">Partager</button>
        </form>
        <div id="shareError" class="error-message" style="display: none;"></div>
        <div id="shareSuccess" class="success-message" style="display: none;"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/supabase-client.js"></script>
  <script src="/dashboard.js"></script>
  <script>
// Fonction de toggle du mode sombre
function toggleDarkMode() {
  const body = document.body;
  const button = document.getElementById('darkModeToggle');
  
  body.classList.toggle('dark-mode');
  
  // Change l'emoji du bouton
  if (body.classList.contains('dark-mode')) {
    button.textContent = '‚òÄÔ∏è';
    button.title = 'Basculer en mode clair';
    localStorage.setItem('darkMode', 'enabled');
  } else {
    button.textContent = 'üåô';
    button.title = 'Basculer en mode sombre';
    localStorage.setItem('darkMode', 'disabled');
  }
}

// Charger la pr√©f√©rence au d√©marrage
document.addEventListener('DOMContentLoaded', () => {
  const darkMode = localStorage.getItem('darkMode');
  const button = document.getElementById('darkModeToggle');
  
  if (darkMode === 'enabled') {
    document.body.classList.add('dark-mode');
    if (button) {
      button.textContent = '‚òÄÔ∏è';
      button.title = 'Basculer en mode clair';
    }
  }
});
</script>
</body>
</html>
